# Чеклист для проверки задания 3

## Общие требования

- [ ] Все файлы сохранены в папке `Task3/`
- [ ] Документация создана и актуальна
- [ ] Код соответствует требованиям задания

## 1. Интеграция с S3 (Minio)

### Конфигурация
- [ ] Minio добавлен в `docker-compose.yaml`
- [ ] Настроены переменные окружения для Minio
- [ ] Bucket `reports` создаётся автоматически при старте

### Зависимости
- [ ] Добавлена зависимость `io.minio:minio` в `pom.xml`
- [ ] Версия Minio client совместима с используемой версией Minio

### Сервисы
- [ ] `S3Config` создан и настроен
- [ ] `S3Service` реализован со всеми необходимыми методами:
  - [ ] `objectExists()` - проверка существования объекта
  - [ ] `putObject()` - сохранение объекта
  - [ ] `getObject()` - получение объекта
  - [ ] `generateReportKey()` - генерация ключа объекта
- [ ] `ReportFileService` реализован для генерации JSON-файлов

### Структура хранения
- [ ] Структура хранения в S3: `reports/{userId}/{startDate}_{endDate}/report.json`
- [ ] Ключи объектов генерируются корректно

## 2. Логика кеширования

### ReportService
- [ ] Метод `getOrGenerateReportKey()` реализован
- [ ] Проверка наличия отчёта в S3 перед запросом к ClickHouse
- [ ] Генерация отчёта только если его нет в S3
- [ ] Автоматическое сохранение сгенерированных отчётов в S3

### ReportController
- [ ] Endpoint `GET /api/reports` возвращает CDN-ссылку вместо данных
- [ ] Endpoint `GET /api/reports/files/reports/**` реализован для получения файлов
- [ ] Проверка доступа пользователя к файлам (только свои отчёты)
- [ ] Корректная обработка ошибок

## 3. CDN (Nginx)

### Конфигурация
- [ ] Nginx добавлен в `docker-compose.yaml`
- [ ] Конфигурация Nginx создана в `Task3/nginx/nginx.conf`
- [ ] Настроено кеширование статических файлов
- [ ] TTL кеша настроен (1 час)

### Функциональность
- [ ] Nginx проксирует запросы к reports service
- [ ] Кеширование работает корректно
- [ ] Заголовки кеширования установлены правильно
- [ ] Статус кеша отображается в заголовке `X-Cache-Status`

### Доступ
- [ ] CDN доступен по адресу `http://localhost:8083`
- [ ] Файлы отчётов доступны через CDN URL

## 4. Конфигурация

### application.yml
- [ ] Добавлена секция `s3` с настройками:
  - [ ] `endpoint`
  - [ ] `access-key`
  - [ ] `secret-key`
  - [ ] `bucket`
- [ ] Добавлена секция `cdn` с настройками:
  - [ ] `base-url`
  - [ ] `public-url`
  - [ ] `cache-ttl`

### docker-compose.yaml
- [ ] Сервис `minio` настроен:
  - [ ] Порты: 9000 (API), 9001 (Console)
  - [ ] Переменные окружения для доступа
  - [ ] Volumes для данных
- [ ] Сервис `nginx-cdn` настроен:
  - [ ] Порт: 8083
  - [ ] Volume для конфигурации Nginx
  - [ ] Volume для кеша
  - [ ] Зависимости от Minio и reports service
- [ ] Сервис `bionicpro-reports` обновлён:
  - [ ] Добавлены переменные окружения для S3 и CDN
  - [ ] Зависимость от Minio

## 5. Тестирование

### Функциональное тестирование
- [ ] Приложение запускается без ошибок
- [ ] Minio доступен и bucket создаётся
- [ ] Nginx запускается и доступен
- [ ] Запрос отчёта через API возвращает CDN-ссылку
- [ ] Первый запрос генерирует отчёт и сохраняет в S3
- [ ] Повторный запрос использует отчёт из S3 (не обращается к ClickHouse)
- [ ] Файл отчёта доступен через CDN URL
- [ ] Nginx кеширует файлы отчётов
- [ ] Проверка доступа: пользователь может получить только свои отчёты

### Проверка кеширования
- [ ] Первый запрос к CDN идёт к reports service
- [ ] Второй запрос к CDN отдаётся из кеша Nginx
- [ ] Заголовок `X-Cache-Status` показывает статус кеша

### Проверка производительности
- [ ] Повторные запросы быстрее (используют кеш)
- [ ] Нагрузка на ClickHouse снижена (запросы только при генерации)

## 6. Документация

- [ ] Создан файл `Task3/IMPLEMENTATION.md` с описанием:
  - [ ] Архитектуры решения
  - [ ] Компонентов системы
  - [ ] Механизма обновления кеша
  - [ ] Конфигурации
  - [ ] Преимуществ и ограничений
- [ ] Документация понятна и полна
- [ ] Описаны рекомендации по улучшению

## 7. Код

### Качество кода
- [ ] Код следует стандартам Java
- [ ] Используются правильные паттерны проектирования
- [ ] Обработка ошибок реализована корректно
- [ ] Логирование добавлено в ключевых местах
- [ ] Нет закомментированного кода
- [ ] Нет дублирования кода

### Безопасность
- [ ] Проверка доступа пользователя к отчётам
- [ ] Credentials для S3 не хардкодятся в коде
- [ ] Используются переменные окружения для секретов

## 8. Структура файлов

- [ ] Все файлы в правильных местах:
  - [ ] `Task3/nginx/nginx.conf` - конфигурация Nginx
  - [ ] `Task3/IMPLEMENTATION.md` - документация
  - [ ] `Task3/CHECKLIST.md` - чеклист
- [ ] Новые Java-классы в правильных пакетах:
  - [ ] `S3Config` в `config`
  - [ ] `S3Service` в `service`
  - [ ] `ReportFileService` в `service`

## 9. Запуск и развёртывание

- [ ] `docker-compose up` запускает все сервисы
- [ ] Все сервисы стартуют без ошибок
- [ ] Порты не конфликтуют
- [ ] Сервисы доступны по указанным адресам

## 10. Финальная проверка

- [ ] Все пункты чеклиста выполнены
- [ ] Код компилируется без ошибок
- [ ] Линтер не показывает ошибок
- [ ] Приложение работает корректно
- [ ] Документация актуальна

---

## Дополнительные проверки (опционально)

- [ ] Добавлены unit-тесты для новых сервисов
- [ ] Добавлены интеграционные тесты
- [ ] Настроен мониторинг использования кеша
- [ ] Добавлены метрики производительности

